{"version":3,"file":"vue.js","sources":["../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/compiler/index.js","../src/init.js","../src/index.js"],"sourcesContent":["// 重写数组中的部分方法\n\nlet oldArrayProto = Array.prototype;\n\nexport let newArrayProto = Object.create(oldArrayProto)\n\nlet methods = [\n  'push',\n  'pop',\n  'shift',\n  'unshift',\n  'reverse',\n  'sort',\n  'splice'\n]\n// concat,slice不会改变原数组\n\nmethods.forEach(method => {\n  newArrayProto[method] = function(...args) {\n    // 调用原来的方法\n    const result = oldArrayProto[method].call(this, ...args)\n    // 调用拦截函数\n    console.log(`调用了${method}方法`, method)\n    let inserted\n    switch(method) {\n      case 'push':\n      case 'unshift':\n        inserted = args\n        break\n      case 'splice':\n        inserted = args.slice(2)\n        break  \n    }\n    if (inserted) observerArray(inserted)\n    return result\n  }\n})\n","import { newArrayProto } from \"./array\"\n\nclass Observer {\n  constructor(data) {\n    this.data = data\n    // data.__ob__ = this\n    Object.defineProperty(data, '__ob__', {\n      value: this,\n      enumerable: false\n    })\n    if (Array.isArray(data)) {\n      data.__proto__  = newArrayProto\n\n      // 重写数组的方法\n      this.observeArray(data)\n    } else {\n      this.walk(data)\n    }\n  }\n  walk(data) {\n    Object.keys(data).forEach(key => defineReactive(data, key, data[key]))\n  }\n  observeArray(data) {\n    data.forEach(item => observe(item))\n    // 数组中每一项也需要被 observe\n  }\n}\n\nexport function defineReactive(target, key, value) {\n  observe(value) // 递归遍历所有子属性\n  Object.defineProperty(target, key, {\n    enumerable: true,\n    configurable: true,\n    get() {\n      // console.log(`获取${key}属性值：${value}`)\n      return value\n    },\n    set(newValue) {\n      // console.log(`设置${key}属性值：${newValue}`)\n      if (newValue === value) {\n        return\n      }\n      observe(value)\n      value = newValue\n    }\n  })\n}\n\nexport function observe(data) {\n  // console.log(data)\n  if (typeof data !== 'object' || data === null) {\n    return\n  }\n\n  if (data.__ob__ instanceof Observer) {\n    return data.__ob__\n  }\n  // 判断对象是否被劫持\n  return new Observer(data)\n}","import { observe } from \"./observe/index\";\n\nexport function initState(vm) {\n  const opts = vm.$options;\n  if (opts.data) {\n    initData(vm);\n  }\n}\n\nfunction initData(vm) {\n  let data = vm.$options.data;\n  data = typeof data === 'function' ? data.call(vm) : data;\n\n  vm._data = data;\n  // 数据劫持 defineProperty / Proxy\n  observe(data)\n\n  for (const key in data) {\n    proxy(vm, '_data', key)\n  }\n}\n\nfunction proxy(vm, target, key) {\n  Object.defineProperty(vm, key, {\n    set(newValue) {\n      vm[target][key] = newValue \n    },\n    get() {\n      return vm[target][key]\n    }\n  })\n}","export function compileToFunction (template) {\n  console.log(1, template)\n}","import { initState } from './state'\nimport { compileToFunction } from './compiler'\n\nexport function initMixin(Vue) {\n  Vue.prototype._init = function (options) {\n    const vm = this;\n    vm.$options = options;\n    // 初始化状态\n    initState(vm);\n\n    if (options.el) {\n      vm.$mount(options.el);\n    }\n  }\n  Vue.prototype.$mount = function(el) {\n    const vm = this;\n    el = document.querySelector(el)\n    let ops = vm.$options\n    if (!ops.render) {\n      let template;\n      if (!ops.tempalte && el) {\n        template = el.outerHTML\n      } else {\n        if (el) {\n          template = ops.template\n        }\n      }\n\n      if (template) {\n        const render = compileToFunction(template)\n        ops.render = render\n      }\n    }\n\n    ops.render\n\n  }\n}\n","import { initMixin } from \"./init\";\n\nfunction Vue(options) {\n  this._init(options) // 初始化\n}\ninitMixin(Vue)\n\nexport default Vue;"],"names":["oldArrayProto","Array","prototype","newArrayProto","Object","create","methods","forEach","method","_oldArrayProto$method","_len","arguments","length","args","_key","result","call","apply","concat","console","log","inserted","slice","observerArray","Observer","data","_classCallCheck","defineProperty","value","enumerable","isArray","__proto__","observeArray","walk","_createClass","key","keys","defineReactive","item","observe","target","configurable","get","set","newValue","_typeof","__ob__","initState","vm","opts","$options","initData","_data","proxy","compileToFunction","template","initMixin","Vue","_init","options","el","$mount","document","querySelector","ops","render","tempalte","outerHTML"],"mappings":"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"}